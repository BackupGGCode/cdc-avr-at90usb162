<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ATMEL: nRF_API.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>nRF_API.h</h1><a href="a00036.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*This file has been prepared for Doxygen automatic documentation generation.*/</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">/* Copyright (c) 2007, Atmel Corporation All rights reserved.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00019"></a>00019 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * 1. Redistributions of source code must retain the above copyright notice,</span>
<a name="l00022"></a>00022 <span class="comment"> * this list of conditions and the following disclaimer.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<a name="l00025"></a>00025 <span class="comment"> * this list of conditions and the following disclaimer in the documentation</span>
<a name="l00026"></a>00026 <span class="comment"> * and/or other materials provided with the distribution.</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> * 3. The name of ATMEL may not be used to endorse or promote products derived</span>
<a name="l00029"></a>00029 <span class="comment"> * from this software without specific prior written permission.</span>
<a name="l00030"></a>00030 <span class="comment"> *</span>
<a name="l00031"></a>00031 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY ATMEL ``AS IS'' AND ANY EXPRESS OR IMPLIED</span>
<a name="l00032"></a>00032 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<a name="l00033"></a>00033 <span class="comment"> * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE EXPRESSLY AND</span>
<a name="l00034"></a>00034 <span class="comment"> * SPECIFICALLY DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR ANY DIRECT,</span>
<a name="l00035"></a>00035 <span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00036"></a>00036 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00037"></a>00037 <span class="comment"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<a name="l00038"></a>00038 <span class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00039"></a>00039 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF</span>
<a name="l00040"></a>00040 <span class="comment"> * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00041"></a>00041 <span class="comment"> */</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#include "<a class="code" href="a00024.html">config.h</a>"</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">// Low level pin definition check (hardware map)</span>
<a name="l00047"></a>00047 <span class="preprocessor">#ifndef  NRF_CS_PORT</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#error   NRF_CS_PORT should be defined somewhere (usually target_board_file.h)</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a>00051 <span class="preprocessor">#ifndef  NRF_CS_PIN</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#error   NRF_CS_PIN should be defined somewhere (usually target_board_file.h)</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>
<a name="l00055"></a>00055 <span class="preprocessor">#ifndef  NRF_CE_PORT</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">#error   NRF_CE_PORT should be defined somewhere (usually target_board_file.h)</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00059"></a>00059 <span class="preprocessor">#ifndef  NRF_CE_PIN</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#error   NRF_CE_PIN should be defined somewhere (usually target_board_file.h)</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00063"></a>00063 <span class="preprocessor">#ifndef  NRF_IRQ_PORT</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#error   NRF_IRQ_PORT should be defined somewhere (usually target_board_file.h)</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a>00067 <span class="preprocessor">#ifndef  NRF_IRQ_PIN</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#error   NRF_IRQ_PIN should be defined somewhere (usually target_board_file.h)</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>
<a name="l00071"></a>00071 <span class="preprocessor">#ifndef  NRF_port_init</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#error   NRF_port_init() should be defined somewhere (usually target_board_file.h)</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">// Pin access</span>
<a name="l00077"></a><a class="code" href="a00036.html#2f37b811776a0365246afbc8447a26cc">00077</a> <span class="preprocessor">#define   NRF_select()           (NRF_CS_PORT &amp;= ~(1&lt;&lt;NRF_CS_PIN))</span>
<a name="l00078"></a><a class="code" href="a00036.html#73dfa5b19148628cb50a9f76849b1e81">00078</a> <span class="preprocessor"></span><span class="preprocessor">#define   NRF_unselect()         (NRF_CS_PORT |= (1&lt;&lt;NRF_CS_PIN))</span>
<a name="l00079"></a><a class="code" href="a00036.html#ba5ead61ba653245bc10ee0979a9eefb">00079</a> <span class="preprocessor"></span><span class="preprocessor">#define   NRF_disable()          (NRF_CE_PORT &amp;= ~(1&lt;&lt;NRF_CE_PIN))</span>
<a name="l00080"></a><a class="code" href="a00036.html#6b68ddb61fac015a5bc47b51ed71caca">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define   NRF_enable()           (NRF_CE_PORT |= (1&lt;&lt;NRF_CE_PIN))</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="comment">// Define nRF24L01 interrupt flag's</span>
<a name="l00084"></a><a class="code" href="a00036.html#9c21a7caee326d7803b94ae1952b27ca">00084</a> <span class="preprocessor">#define IDLE            0x00  // Idle, no interrupt pending</span>
<a name="l00085"></a><a class="code" href="a00036.html#b4482ead4f3b452a032f63ac03ee1870">00085</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_RT          0x10  // Max #of TX retrans interrupt</span>
<a name="l00086"></a><a class="code" href="a00036.html#b5f5243908a39ffd514fe701e9749bdc">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define TX_DS           0x20  // TX data sent interrupt</span>
<a name="l00087"></a><a class="code" href="a00036.html#312d1f2745a86149b27cff7d61e715df">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_DR           0x40  // RX data received</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a><a class="code" href="a00036.html#acc88917482b569cf295930ec6e7c24d">00089</a> <span class="preprocessor">#define SPI_CFG         0x40  // SPI Configuration register value</span>
<a name="l00090"></a><a class="code" href="a00036.html#611f6a2d18f35df332e1f3088042cec3">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI_CTR         0x01  // SPI Control register values</span>
<a name="l00091"></a><a class="code" href="a00036.html#f3cfe48f6efdc257518227b43c1bc3df">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI_CLK         0x00  // SYSCLK/2*(SPI_CLK+1) == &gt; 12MHz / 2 = 6MHz</span>
<a name="l00092"></a><a class="code" href="a00036.html#c8be5c6dfd35fdcd73d807c4bed7ac8c">00092</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI0E           0x02  // SPI Enable in XBR0 register</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">// SPI(nRF24L01) commands</span>
<a name="l00096"></a><a class="code" href="a00036.html#0de38d1ad757dd761c5714b09125d717">00096</a> <span class="preprocessor">#define READ_REG        0x00  // Define read command to register</span>
<a name="l00097"></a><a class="code" href="a00036.html#b4589895853859c8ae1e26287efa3c1d">00097</a> <span class="preprocessor"></span><span class="preprocessor">#define WRITE_REG       0x20  // Define write command to register</span>
<a name="l00098"></a><a class="code" href="a00036.html#34e32f32935efe2d958ca16d48831009">00098</a> <span class="preprocessor"></span><span class="preprocessor">#define RD_RX_PLOAD     0x61  // Define RX payload register address</span>
<a name="l00099"></a><a class="code" href="a00036.html#97a60093aef6135e38bd0bd91cd40428">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define WR_TX_PLOAD     0xA0  // Define TX payload register address</span>
<a name="l00100"></a><a class="code" href="a00036.html#bce47e8066832b6ac4e18162a79859b4">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define FLUSH_TX        0xE1  // Define flush TX register command</span>
<a name="l00101"></a><a class="code" href="a00036.html#b2418a6171d7f1eefd458927fdfe7057">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define FLUSH_RX        0xE2  // Define flush RX register command</span>
<a name="l00102"></a><a class="code" href="a00036.html#2f1d9bb858232e8b1494b60aa9a7d25a">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define REUSE_TX_PL     0xE3  // Define reuse TX payload register command</span>
<a name="l00103"></a><a class="code" href="a00036.html#700f88377bf36711b711f69b06c52f5d">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define NOP             0xFF  // Define No Operation, might be used to read status register</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>
<a name="l00105"></a>00105 <span class="comment">// SPI(nRF24L01) registers(addresses)</span>
<a name="l00106"></a><a class="code" href="a00036.html#76ea3cf49247a07c54b3db005a3c7f57">00106</a> <span class="preprocessor">#define CONFIG          0x00  // 'Config' register address</span>
<a name="l00107"></a><a class="code" href="a00036.html#a84a282351a2c9b83dd653df6ac59216">00107</a> <span class="preprocessor"></span><span class="preprocessor">#define EN_AA           0x01  // 'Enable Auto Acknowledgment' register address</span>
<a name="l00108"></a><a class="code" href="a00036.html#b6b2378ce9cab6ccafb6d30c774c5307">00108</a> <span class="preprocessor"></span><span class="preprocessor">#define EN_RXADDR       0x02  // 'Enabled RX addresses' register address</span>
<a name="l00109"></a><a class="code" href="a00036.html#f5ef355ba3eca336db1285cab353ddc2">00109</a> <span class="preprocessor"></span><span class="preprocessor">#define SETUP_AW        0x03  // 'Setup address width' register address</span>
<a name="l00110"></a><a class="code" href="a00036.html#2188309b3eceeae158dd64109cd919aa">00110</a> <span class="preprocessor"></span><span class="preprocessor">#define SETUP_RETR      0x04  // 'Setup Auto. Retrans' register address</span>
<a name="l00111"></a><a class="code" href="a00036.html#5c4da84e4a01531aa9f5c3e617848d66">00111</a> <span class="preprocessor"></span><span class="preprocessor">#define RF_CH           0x05  // 'RF channel' register address</span>
<a name="l00112"></a><a class="code" href="a00036.html#d95edb7665f39454d7d7fd436301712b">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define RF_SETUP        0x06  // 'RF setup' register address</span>
<a name="l00113"></a><a class="code" href="a00036.html#59279bee44f34d08b3cbf3a89fb0d8d9">00113</a> <span class="preprocessor"></span><span class="preprocessor">#define STATUS          0x07  // 'Status' register address</span>
<a name="l00114"></a><a class="code" href="a00036.html#491468eaa7f2db84c152709b0b5fb1aa">00114</a> <span class="preprocessor"></span><span class="preprocessor">#define OBSERVE_TX      0x08  // 'Observe TX' register address</span>
<a name="l00115"></a><a class="code" href="a00036.html#1050140a3d78b059f809a424e0d9e1c7">00115</a> <span class="preprocessor"></span><span class="preprocessor">#define CD              0x09  // 'Carrier Detect' register address</span>
<a name="l00116"></a><a class="code" href="a00036.html#dc82a1b0dee303d8b783b9b9a89ae5aa">00116</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_ADDR_P0      0x0A  // 'RX address pipe0' register address</span>
<a name="l00117"></a><a class="code" href="a00036.html#d4b44f18e4b27b07af84783d8f11726d">00117</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_ADDR_P1      0x0B  // 'RX address pipe1' register address</span>
<a name="l00118"></a><a class="code" href="a00036.html#c10ad4b1d3ace06cc269098d1863f411">00118</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_ADDR_P2      0x0C  // 'RX address pipe2' register address</span>
<a name="l00119"></a><a class="code" href="a00036.html#01228e7b997954bc9d715c8289731181">00119</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_ADDR_P3      0x0D  // 'RX address pipe3' register address</span>
<a name="l00120"></a><a class="code" href="a00036.html#fc579afe21136cd3f72b3ac805086726">00120</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_ADDR_P4      0x0E  // 'RX address pipe4' register address</span>
<a name="l00121"></a><a class="code" href="a00036.html#49dfc07335896551e8c7797594658b07">00121</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_ADDR_P5      0x0F  // 'RX address pipe5' register address</span>
<a name="l00122"></a><a class="code" href="a00036.html#a734c6e08b9f794436eacbabe466a6c4">00122</a> <span class="preprocessor"></span><span class="preprocessor">#define TX_ADDR         0x10  // 'TX address' register address</span>
<a name="l00123"></a><a class="code" href="a00036.html#060e61d8f6e7ad28984540faa85cdecf">00123</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_PW_P0        0x11  // 'RX payload width, pipe0' register address</span>
<a name="l00124"></a><a class="code" href="a00036.html#a260ec97512905cec17f8ade82bc550d">00124</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_PW_P1        0x12  // 'RX payload width, pipe1' register address</span>
<a name="l00125"></a><a class="code" href="a00036.html#38a4904a52517c8d339c689230a6567d">00125</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_PW_P2        0x13  // 'RX payload width, pipe2' register address</span>
<a name="l00126"></a><a class="code" href="a00036.html#44bdf6946c1ae047ea2a2c981244d4d8">00126</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_PW_P3        0x14  // 'RX payload width, pipe3' register address</span>
<a name="l00127"></a><a class="code" href="a00036.html#5cdda00ab52df1537b6b5d61ef88ba8f">00127</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_PW_P4        0x15  // 'RX payload width, pipe4' register address</span>
<a name="l00128"></a><a class="code" href="a00036.html#9ce52902779e18d4fed3685b0f8be582">00128</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_PW_P5        0x16  // 'RX payload width, pipe5' register address</span>
<a name="l00129"></a><a class="code" href="a00036.html#9e5c9878194f462bf7a46ca8a7b8f9d2">00129</a> <span class="preprocessor"></span><span class="preprocessor">#define FIFO_STATUS     0x17  // 'FIFO Status Register' register address</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>
<a name="l00131"></a>00131 <span class="comment">// Status bits definition</span>
<a name="l00132"></a><a class="code" href="a00036.html#8875452ea824d9cdaec5bbf520bcc6fa">00132</a> <span class="preprocessor">#define NRF_RX_DR   6</span>
<a name="l00133"></a><a class="code" href="a00036.html#11b455442742b748465a21aa5a5a1ee8">00133</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_TX_DR   5</span>
<a name="l00134"></a><a class="code" href="a00036.html#a8de80d008bac8de2eea8041f5b7fbd1">00134</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_MAX_RT  4</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">// Public and usefull driver access</span>
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="a00036.html#9dd235dc20117c900275967431f6b827">00140</a> <span class="preprocessor">#define NFR_read_reg(reg)        (NRF_Read(reg|READ_REG))</span>
<a name="l00141"></a><a class="code" href="a00036.html#205f2a503f18930ffe49c0464f031c53">00141</a> <span class="preprocessor"></span><span class="preprocessor">#define NFR_write_reg(reg,val)   (NRF_RW_Reg(reg|WRITE_REG,val))</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>
<a name="l00143"></a><a class="code" href="a00036.html#c5b12e0ade686e265859c9422100f114">00143</a> <span class="preprocessor">#define NRF_init_tx()            (NRF_disable(),NFR_write_reg(CONFIG,0x0A))  // Prim TX, CRC</span>
<a name="l00144"></a><a class="code" href="a00036.html#d6d5d99bf779c0dad9614be115207a67">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_init_rx()            (NRF_disable(),NFR_write_reg(CONFIG,0x0B),NRF_enable())  // Prim RX, CRC, PowerUp</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>
<a name="l00146"></a><a class="code" href="a00036.html#008d5fad0a8615789e3fa4594d2d9096">00146</a> <span class="preprocessor">#define Is_not_NRF_IRQ()         ((NRF_IRQ_PORT &amp; (1&lt;&lt;NRF_IRQ_PIN))? TRUE : FALSE)</span>
<a name="l00147"></a><a class="code" href="a00036.html#c7fdfd097b73887593ef37fa0445d9df">00147</a> <span class="preprocessor"></span><span class="preprocessor">#define Is_NRF_IRQ()             ((NRF_IRQ_PORT &amp; (1&lt;&lt;NRF_IRQ_PIN))? FALSE : TRUE)</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span>
<a name="l00149"></a>00149 
<a name="l00150"></a><a class="code" href="a00036.html#b4bd3d19acaa659f167a0645bbb6f0f6">00150</a> <span class="preprocessor">#define NRF_tx_buffer(buf,n)     (NRF_write_buf(WR_TX_PLOAD,buf,n))</span>
<a name="l00151"></a><a class="code" href="a00036.html#896ec9d08a6354384453b604643f1225">00151</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_rx_buffer(buf,n)     (NRF_read_buf(RD_RX_PLOAD,buf,n))</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>
<a name="l00153"></a><a class="code" href="a00036.html#b5d9e5c03c5eba1330173109621c9171">00153</a> <span class="preprocessor">#define NRF_set_payload(pipe,n)  (NFR_write_reg(RX_PW_P##pipe,n))</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>
<a name="l00155"></a><a class="code" href="a00036.html#4c883bd8d20b8fcd823bbd5fbf4a6f49">00155</a> <span class="preprocessor">#define NRF_set_channel(n)       (NFR_write_reg(RF_CH,n))</span>
<a name="l00156"></a><a class="code" href="a00036.html#f234d2425fac638b7fb9b4c7f923f0a1">00156</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_set_byte_addr(n)     (NFR_write_reg(SETUP_AW,n-2))</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>
<a name="l00158"></a><a class="code" href="a00036.html#acae263b1436ac2b01d1d8c0c0a4f91f">00158</a> <span class="preprocessor">#define NRF_ack_RX_DR()          (NFR_write_reg(STATUS,(1&lt;&lt;NRF_RX_DR)))</span>
<a name="l00159"></a><a class="code" href="a00036.html#d5d9bfb71e52a7b1015073ee11034682">00159</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_ack_TX_DR()          (NFR_write_reg(STATUS,(1&lt;&lt;NRF_TX_DR)))</span>
<a name="l00160"></a><a class="code" href="a00036.html#27aa1f724681769d23bae865f8d10ab6">00160</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_ack_MAX_RT()         (NFR_write_reg(STATUS,(1&lt;&lt;NRF_MAX_RT)))</span>
<a name="l00161"></a><a class="code" href="a00036.html#f3d8051656fba7831a8bd560ec478102">00161</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_ack_received()       (NRF_ack_RX_DR())</span>
<a name="l00162"></a><a class="code" href="a00036.html#02abe6a7d8128baadb94f5d29da743ee">00162</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_ack_transmit()       (NRF_ack_TX_DR())</span>
<a name="l00163"></a><a class="code" href="a00036.html#a03450b886083bd50fc8b79bf9779cf1">00163</a> <span class="preprocessor"></span><span class="preprocessor">#define NRF_ack_timeout()        (NRF_ack_MAX_RT())</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>
<a name="l00165"></a><a class="code" href="a00036.html#cc9ca9b6da5665fc6d8b5c2de5855306">00165</a> <span class="preprocessor">#define NRF_flush_rx()           (NFR_write_reg(FLUSH_RX,0))</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span>
<a name="l00167"></a><a class="code" href="a00036.html#c2a41049632da56408234360ac1b8bfb">00167</a> <span class="preprocessor">#define Is_NRF_RX_DR()           (NFR_read_reg(STATUS)&amp;(1&lt;&lt;NRF_RX_DR) ? TRUE : FALSE)</span>
<a name="l00168"></a><a class="code" href="a00036.html#faf2f766b21d2e7b45549841aa74d9ad">00168</a> <span class="preprocessor"></span><span class="preprocessor">#define Is_NRF_TX_DR()           (NFR_read_reg(STATUS)&amp;(1&lt;&lt;NRF_TX_DR) ? TRUE : FALSE)</span>
<a name="l00169"></a><a class="code" href="a00036.html#dca494729eee1e9532424b1299f47317">00169</a> <span class="preprocessor"></span><span class="preprocessor">#define Is_NRF_MAX_RT()          (NFR_read_reg(STATUS)&amp;(1&lt;&lt;NRF_MAX_RT) ? TRUE : FALSE)</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>
<a name="l00171"></a><a class="code" href="a00036.html#5c01f673a46496d83bb673dca1cc5ef7">00171</a> <span class="preprocessor">#define Is_NRF_received()        (Is_NRF_RX_DR())</span>
<a name="l00172"></a><a class="code" href="a00036.html#a082e0f8f3a3ee737a0472789b8958df">00172</a> <span class="preprocessor"></span><span class="preprocessor">#define Is_NRF_transmit()        (Is_NRF_TX_DR())</span>
<a name="l00173"></a><a class="code" href="a00036.html#2d096c9b41fb1bc51c25c66b44f2344b">00173</a> <span class="preprocessor"></span><span class="preprocessor">#define Is_NRF_timeout()         (Is_NRF_MAX_RT())</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>
<a name="l00175"></a><a class="code" href="a00036.html#41c5dad13cee751aaf8dd19b5d6d9d18">00175</a> <span class="preprocessor">#define NRF_Write_addr(reg,buf,n)   NRF_write_buf(reg+0x20,buf, n)</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>
<a name="l00177"></a>00177 <span class="comment">//_____ D E C L A R A T I O N S ____________________________________________</span>
<a name="l00178"></a>00178 
<a name="l00179"></a>00179  <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> <a class="code" href="a00036.html#e0bd5aa9b36f46a9668d4d34dfd4f2a5">SPI_RW</a>(<a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> byte);                                <span class="comment">// Single SPI read/write</span>
<a name="l00180"></a>00180  <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> <a class="code" href="a00035.html#ec197f260d62f70285ef5c14a874aca1">NRF_Read</a>(<a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> reg);                               <span class="comment">// Read one byte from nRF24L01</span>
<a name="l00181"></a>00181  <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> <a class="code" href="a00035.html#500e0a5e1a6dcabed1eb20f1c51cd6d3">NRF_RW_Reg</a>(<a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> reg, <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> value);                 <span class="comment">// Write one byte to register 'reg'</span>
<a name="l00182"></a>00182  <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> <a class="code" href="a00035.html#82238ef5299abf89313c36ac94c7ee89">NRF_read_buf</a>(<a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> reg, <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> *pBuf, <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> bytes);   <span class="comment">// Read multiply bytes from one register</span>
<a name="l00183"></a>00183  <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> <a class="code" href="a00035.html#9856ea5a03c048d29e4670d94a87f51f">NRF_write_buf</a>(<a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> reg, <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> *pBuf, <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> bytes);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="comment">//_____ S A M P L E   U S A G E with AT90USB128 USB software library _______</span>
<a name="l00187"></a>00187 <span class="preprocessor">#if 0</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00189"></a>00189 <span class="comment">//_____  I N C L U D E S ___________________________________________________</span>
<a name="l00190"></a>00190 <span class="comment"></span>
<a name="l00191"></a>00191 <span class="comment">#include "config.h"</span>
<a name="l00192"></a>00192 <span class="comment">#include "conf_usb.h"</span>
<a name="l00193"></a>00193 <span class="comment">#include "rf_task.h"</span>
<a name="l00194"></a>00194 <span class="comment">#include "lib_mcu/usb/usb_drv.h"</span>
<a name="l00195"></a>00195 <span class="comment">#include "usb_descriptors.h"</span>
<a name="l00196"></a>00196 <span class="comment">#include "modules/usb/device_chap9/usb_standard_request.h"</span>
<a name="l00197"></a>00197 <span class="comment">#include "usb_specific_request.h"</span>
<a name="l00198"></a>00198 <span class="comment">#include "lib_mcu/spi/spi_lib.h"</span>
<a name="l00199"></a>00199 <span class="comment">#include "lib_board/nrf24l01/nRF_API.h"</span>
<a name="l00200"></a>00200 <span class="comment"></span>
<a name="l00201"></a>00201 <span class="comment"></span>
<a name="l00202"></a>00202 <span class="comment"></span>
<a name="l00203"></a>00203 <span class="comment">//_____ M A C R O S ________________________________________________________</span>
<a name="l00204"></a>00204 <span class="comment"></span>
<a name="l00205"></a>00205 <span class="comment"></span>
<a name="l00206"></a>00206 <span class="comment">//_____ D E F I N I T I O N S ______________________________________________</span>
<a name="l00207"></a>00207 <span class="comment"></span>
<a name="l00208"></a>00208 <span class="comment">//_____ D E C L A R A T I O N S ____________________________________________</span>
<a name="l00209"></a>00209 <span class="comment"></span>
<a name="l00210"></a>00210 <span class="comment">volatile U8  tmp;</span>
<a name="l00211"></a>00211 <span class="comment">U8 rx_buf[32];</span>
<a name="l00212"></a>00212 <span class="comment">U8 tx_buf[32];</span>
<a name="l00213"></a>00213 <span class="comment"></span>
<a name="l00222"></a>00222 <span class="comment">void rf_task_init(void)</span>
<a name="l00223"></a>00223 <span class="comment">{</span>
<a name="l00224"></a>00224 <span class="comment">   Leds_init();</span>
<a name="l00225"></a>00225 <span class="comment">   NRF_port_init();</span>
<a name="l00226"></a>00226 <span class="comment">   spi_init(SPI_MASTER);</span>
<a name="l00227"></a>00227 <span class="comment">   NRF_init_rx();           // Set nRf primary receiver</span>
<a name="l00228"></a>00228 <span class="comment">   NRF_set_payload(0,8);    // Pipe 0 receiver is 8 bytes</span>
<a name="l00229"></a>00229 <span class="comment">   NRF_enable();            // Enable receiver</span>
<a name="l00230"></a>00230 <span class="comment">}</span>
<a name="l00231"></a>00231 <span class="comment"></span>
<a name="l00232"></a>00232 <span class="comment"></span>
<a name="l00233"></a>00233 <span class="comment"></span>
<a name="l00234"></a>00234 <span class="comment"></span>
<a name="l00235"></a>00235 <span class="comment"></span>
<a name="l00244"></a>00244 <span class="comment">void rf_task(void)</span>
<a name="l00245"></a>00245 <span class="comment">{</span>
<a name="l00246"></a>00246 <span class="comment">   U8 i;</span>
<a name="l00247"></a>00247 <span class="comment"></span>
<a name="l00248"></a>00248 <span class="comment">   if(Is_device_enumerated())             // Check USB HID is enumerated</span>
<a name="l00249"></a>00249 <span class="comment">   {</span>
<a name="l00250"></a>00250 <span class="comment">      Usb_select_endpoint(EP_HID_OUT);    // Get Data repport from Host</span>
<a name="l00251"></a>00251 <span class="comment">      if(Is_usb_receive_out())            // Something received on the USB?</span>
<a name="l00252"></a>00252 <span class="comment">      {</span>
<a name="l00253"></a>00253 <span class="comment">         for(i=0;i&lt;EP_OUT_LENGTH;i++)</span>
<a name="l00254"></a>00254 <span class="comment">         {</span>
<a name="l00255"></a>00255 <span class="comment">            tx_buf[i]=Usb_read_byte();</span>
<a name="l00256"></a>00256 <span class="comment">         }</span>
<a name="l00257"></a>00257 <span class="comment">         NRF_init_tx();                   // RF is Tx mode</span>
<a name="l00258"></a>00258 <span class="comment">         NRF_tx_buffer(tx_buf, 8);        // Send data to Rf</span>
<a name="l00259"></a>00259 <span class="comment">         while(Is_not_NRF_IRQ());         // Wait event from Rf</span>
<a name="l00260"></a>00260 <span class="comment">         if(Is_NRF_transmit())            // Data sent ?</span>
<a name="l00261"></a>00261 <span class="comment">         {</span>
<a name="l00262"></a>00262 <span class="comment">            NRF_ack_TX_DR();</span>
<a name="l00263"></a>00263 <span class="comment">         }</span>
<a name="l00264"></a>00264 <span class="comment">         else if (Is_NRF_timeout())</span>
<a name="l00265"></a>00265 <span class="comment">         {</span>
<a name="l00266"></a>00266 <span class="comment">            NRF_ack_MAX_RT();</span>
<a name="l00267"></a>00267 <span class="comment">         }</span>
<a name="l00268"></a>00268 <span class="comment">         NRF_init_rx();</span>
<a name="l00269"></a>00269 <span class="comment">         Usb_ack_receive_out();</span>
<a name="l00270"></a>00270 <span class="comment">      }</span>
<a name="l00271"></a>00271 <span class="comment"></span>
<a name="l00272"></a>00272 <span class="comment">      if (Is_NRF_IRQ())                            // Something received on Rf ?</span>
<a name="l00273"></a>00273 <span class="comment">      {</span>
<a name="l00274"></a>00274 <span class="comment">         if(Is_NRF_received())</span>
<a name="l00275"></a>00275 <span class="comment">         {</span>
<a name="l00276"></a>00276 <span class="comment">            Led_usb_toggle();</span>
<a name="l00277"></a>00277 <span class="comment">            NRF_rx_buffer(rx_buf,8);               // Get data from Rf</span>
<a name="l00278"></a>00278 <span class="comment">            Usb_select_endpoint(EP_HID_IN);        // Ready to send these information to the host application</span>
<a name="l00279"></a>00279 <span class="comment">            while(Is_usb_write_enabled()==FALSE);  // Wait EP ready</span>
<a name="l00280"></a>00280 <span class="comment">            {</span>
<a name="l00281"></a>00281 <span class="comment">               for(i=0;i&lt;EP_IN_LENGTH;i++)</span>
<a name="l00282"></a>00282 <span class="comment">               {</span>
<a name="l00283"></a>00283 <span class="comment">                  Usb_write_byte(rx_buf[i]);</span>
<a name="l00284"></a>00284 <span class="comment">               }</span>
<a name="l00285"></a>00285 <span class="comment">               Usb_ack_in_ready();                 // Send data over the USB</span>
<a name="l00286"></a>00286 <span class="comment">            }</span>
<a name="l00287"></a>00287 <span class="comment">            NRF_ack_RX_DR();</span>
<a name="l00288"></a>00288 <span class="comment">         }</span>
<a name="l00289"></a>00289 <span class="comment">      }</span>
<a name="l00290"></a>00290 <span class="comment">   }</span>
<a name="l00291"></a>00291 <span class="comment">}</span>
<a name="l00292"></a>00292 <span class="comment">*/</span>
<a name="l00293"></a>00293 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Jul 7 16:29:49 2008 for ATMEL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
