<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ATMEL: spi_lib.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>spi_lib.c File Reference</h1>This file provides a minimal funtion set for the SPI. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="a00093.html">config.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00113.html">lib_mcu/spi/spi_lib.h</a>&quot;</code><br>

<p>
Include dependency graph for spi_lib.c:<p><center><img src="a00164.png" border="0" usemap="#spi_lib.c_map" alt=""></center>
<map name="spi_lib.c_map">
<area href="a00024.html" shape="rect" coords="510,56,579,83" alt="">
<area href="a00044.html" shape="rect" coords="126,82,267,108" alt="">
<area href="a00021.html" shape="rect" coords="710,6,843,32" alt="">
<area href="a00022.html" shape="rect" coords="700,56,852,83" alt="">
<area href="a00016.html" shape="rect" coords="628,107,924,134" alt="">
<area href="a00042.html" shape="rect" coords="315,82,462,108" alt="">
</map>

<p>
<a href="a00112.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bit&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00043.html#2518b696fdac8a5db04df0a8a015a46a">spi_test_hit</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if a bytes has been received on the SPI.  <a href="#2518b696fdac8a5db04df0a8a015a46a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bit&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00043.html#4c5cedba18601dd8c677258fe466b38e">spi_init</a> (<a class="el" href="a00044.html#47c19de1cf7c34b0a9ecc627ed7cd5f8">spi_cf_t</a> config)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function configures the SPI controller:<ol type=1>
<li>MASTER or SLAVE</li><li>bit timing</li><li>enable the controller. </li></ol>
 <a href="#4c5cedba18601dd8c677258fe466b38e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00043.html#398a029d2fb491142387d70f061f4cb9">spi_putchar</a> (char ch)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function sends a byte on the SPI.  <a href="#398a029d2fb491142387d70f061f4cb9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00043.html#fcaf2ef1459468c4c3e213377426265f">spi_getchar</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function reads a byte on the SPI.  <a href="#fcaf2ef1459468c4c3e213377426265f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00043.html#26c2665288058fd83396fed7e3159608">SPI_Transmit_Master</a> (char cData)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">SPI Make the transmission possible.  <a href="#26c2665288058fd83396fed7e3159608"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00043.html#48058f0d26bed0107d1f0141b557ad8b">spi_rw</a> (char tx)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>(char</em>&nbsp;</td><td>tx), the data byte to send </td></tr>
  </table>
</dl>
 <a href="#48058f0d26bed0107d1f0141b557ad8b"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This file provides a minimal funtion set for the SPI. 
<p>
<ul>
<li>Compiler: IAR EWAVR and GNU GCC for AVR</li><li>Supported devices: AT90USB162, AT90USB82</li></ul>
<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support and FAQ: <a href="http://support.atmel.no/">http://support.atmel.no/</a> </dd></dl>

<p>
Definition in file <a class="el" href="a00112.html">spi_lib.c</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="2518b696fdac8a5db04df0a8a015a46a"></a><!-- doxytag: member="spi_lib.c::spi_test_hit" ref="2518b696fdac8a5db04df0a8a015a46a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bit spi_test_hit           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if a bytes has been received on the SPI. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE if byte received </dd></dl>

<p>
Definition at line <a class="el" href="a00112.html#l00053">53</a> of file <a class="el" href="a00112.html">spi_lib.c</a>.
<p>
References <a class="el" href="a00111.html#l00126">Spi_rx_ready</a>.<div class="fragment"><pre class="fragment"><a name="l00054"></a>00054 {
<a name="l00055"></a>00055 <span class="keywordflow">return</span> <a class="code" href="a00042.html#72914390ad0a8cd0ed65fb32458e7b81">Spi_rx_ready</a>();
<a name="l00056"></a>00056 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4c5cedba18601dd8c677258fe466b38e"></a><!-- doxytag: member="spi_lib.c::spi_init" ref="4c5cedba18601dd8c677258fe466b38e" args="(spi_cf_t config)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bit spi_init           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00044.html#47c19de1cf7c34b0a9ecc627ed7cd5f8">spi_cf_t</a>&nbsp;</td>
          <td class="paramname"> <em>config</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function configures the SPI controller:<ol type=1>
<li>MASTER or SLAVE</li><li>bit timing</li><li>enable the controller. </li></ol>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>configuration</em>&nbsp;</td><td>of the node (MASTER or SLAVE). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>configuration</em>&nbsp;</td><td>of mode (SPI_MASTER_MODE_0...SPI_MASTER_MODE_3 or SPI_SLAVE_MODE_0...SPI_SLAVE_MODE_3).</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>status of the init:<ol type=1>
<li>TRUE</li><li>FALSE</li></ol>
</dd></dl>
<dl class="pre" compact><dt><b>Precondition:</b></dt><dd>before calling this function some declaration must be define in <a class="el" href="a00024.html">config.h</a>:<br>
<ul>
<li>SPI_CONFIG select the prescaler, CPHA leading, CPOL LOW, LSB first. </li></ul>
</dd></dl>

<p>
Definition at line <a class="el" href="a00112.html#l00059">59</a> of file <a class="el" href="a00112.html">spi_lib.c</a>.
<p>
References <a class="el" href="a00093.html#l00088">SPI_CONFIG</a>, <a class="el" href="a00111.html#l00105">Spi_enable</a>, <a class="el" href="a00111.html#l00122">Spi_hw_init</a>, <a class="el" href="a00111.html#l00127">Spi_init_bus</a>, <a class="el" href="a00044.html#47c19de1cf7c34b0a9ecc627ed7cd5f884379dc90398ca075038c8d5ee465f6a">SPI_MASTER</a>, <a class="el" href="a00111.html#l00110">Spi_select_master_mode</a>, <a class="el" href="a00111.html#l00109">Spi_select_slave_mode</a>, <a class="el" href="a00111.html#l00121">Spi_set_doublespeed</a>, and <a class="el" href="a00090.html#l00252">TRUE</a>.
<p>
Referenced by <a class="el" href="a00088.html#l00099">cdc_rf_task_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00060"></a>00060 {
<a name="l00061"></a>00061    <a class="code" href="a00042.html#28826d8905e9c9eb49f260d2fba4d588">Spi_init_bus</a>();
<a name="l00062"></a>00062    <span class="keywordflow">if</span>(config == <a class="code" href="a00044.html#47c19de1cf7c34b0a9ecc627ed7cd5f884379dc90398ca075038c8d5ee465f6a">SPI_MASTER</a>){<a class="code" href="a00042.html#a9337c710a2dda5154c00a1b7149eb6e">Spi_select_master_mode</a>();}
<a name="l00063"></a>00063    <span class="keywordflow">else</span>                    {<a class="code" href="a00042.html#d43c0657cb30ef0e9f7238cfe2f2ac9a">Spi_select_slave_mode</a>();}
<a name="l00064"></a>00064 
<a name="l00065"></a>00065    <a class="code" href="a00042.html#3aab3dd4172237e3edf26fa0d31fec09">Spi_hw_init</a>(<a class="code" href="a00066.html#g3a187c8b0923b496a552bcf4ab884323">SPI_CONFIG</a>);
<a name="l00066"></a>00066    <a class="code" href="a00042.html#091eb6503af771e928051a7bfe251ff5">Spi_set_doublespeed</a>();<span class="comment">/*to delete if wished*/</span>
<a name="l00067"></a>00067    <a class="code" href="a00042.html#c8234d59f9ec0048276dfcdfd70e6479">Spi_enable</a>();
<a name="l00068"></a>00068    <span class="keywordflow">return</span> <a class="code" href="a00021.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00069"></a>00069 }
</pre></div>
<p>

<p>
Here is the caller graph for this function:<p><center><img src="a00043_4c5cedba18601dd8c677258fe466b38e_icgraph.png" border="0" usemap="#a00043_4c5cedba18601dd8c677258fe466b38e_icgraph_map" alt=""></center>
<map name="a00043_4c5cedba18601dd8c677258fe466b38e_icgraph_map">
<area href="a00019.html#d8b13fae75396c1142b12e8400bf8282" shape="rect" coords="117,5,232,32" alt="">
</map>

</div>
</div><p>
<a class="anchor" name="398a029d2fb491142387d70f061f4cb9"></a><!-- doxytag: member="spi_lib.c::spi_putchar" ref="398a029d2fb491142387d70f061f4cb9" args="(char ch)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char spi_putchar           </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>uc_wr_byte</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function sends a byte on the SPI. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>character</em>&nbsp;</td><td>to send on the SPI.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>character sent </dd></dl>

<p>
Definition at line <a class="el" href="a00112.html#l00072">72</a> of file <a class="el" href="a00112.html">spi_lib.c</a>.
<p>
References <a class="el" href="a00111.html#l00115">Spi_send_byte</a>, and <a class="el" href="a00111.html#l00125">Spi_tx_ready</a>.<div class="fragment"><pre class="fragment"><a name="l00073"></a>00073 {
<a name="l00074"></a>00074    <a class="code" href="a00042.html#e4fd4823c8d5851c5c2d6b9c79313437">Spi_send_byte</a>(ch);
<a name="l00075"></a>00075    <span class="keywordflow">while</span>(!<a class="code" href="a00042.html#c0f831f83d9c04d324587a6395e05852">Spi_tx_ready</a>());
<a name="l00076"></a>00076    <span class="keywordflow">return</span> ch;
<a name="l00077"></a>00077 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="fcaf2ef1459468c4c3e213377426265f"></a><!-- doxytag: member="spi_lib.c::spi_getchar" ref="fcaf2ef1459468c4c3e213377426265f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char spi_getchar           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function reads a byte on the SPI. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>character read </dd></dl>

<p>
Definition at line <a class="el" href="a00112.html#l00081">81</a> of file <a class="el" href="a00112.html">spi_lib.c</a>.
<p>
References <a class="el" href="a00111.html#l00124">Spi_get_byte</a>, and <a class="el" href="a00111.html#l00126">Spi_rx_ready</a>.<div class="fragment"><pre class="fragment"><a name="l00082"></a>00082 {
<a name="l00083"></a>00083 
<a name="l00084"></a>00084    <span class="keyword">register</span> <span class="keywordtype">char</span> c;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086    <span class="keywordflow">while</span>(!<a class="code" href="a00042.html#72914390ad0a8cd0ed65fb32458e7b81">Spi_rx_ready</a>());
<a name="l00087"></a>00087    c = <a class="code" href="a00042.html#94d7d9f417cfd1610363d8eb3a7fffbb">Spi_get_byte</a>();
<a name="l00088"></a>00088    <span class="keywordflow">return</span> c;
<a name="l00089"></a>00089 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="26c2665288058fd83396fed7e3159608"></a><!-- doxytag: member="spi_lib.c::SPI_Transmit_Master" ref="26c2665288058fd83396fed7e3159608" args="(char cData)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SPI_Transmit_Master           </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>cData</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
SPI Make the transmission possible. 
<p>
<dl class="warning" compact><dt><b>Warning:</b></dt><dd>See SPI section in datasheet</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>(char</em>&nbsp;</td><td>cData)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>nothing. </dd></dl>

<p>
Definition at line <a class="el" href="a00112.html#l00091">91</a> of file <a class="el" href="a00112.html">spi_lib.c</a>.
<p>
References <a class="el" href="a00111.html#l00115">Spi_send_byte</a>, and <a class="el" href="a00111.html#l00118">Spi_wait_eot</a>.<div class="fragment"><pre class="fragment"><a name="l00092"></a>00092 {
<a name="l00093"></a>00093      <span class="comment">/* Wait for transmission complete */</span>
<a name="l00094"></a>00094    <a class="code" href="a00042.html#8bfa5249c4eb2238575a5a14ef77963d">Spi_wait_eot</a>();
<a name="l00095"></a>00095      <span class="comment">/* Start new transmission */</span>
<a name="l00096"></a>00096    <a class="code" href="a00042.html#e4fd4823c8d5851c5c2d6b9c79313437">Spi_send_byte</a>(cData);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="48058f0d26bed0107d1f0141b557ad8b"></a><!-- doxytag: member="spi_lib.c::spi_rw" ref="48058f0d26bed0107d1f0141b557ad8b" args="(char tx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char spi_rw           </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>tx</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>(char</em>&nbsp;</td><td>tx), the data byte to send </td></tr>
  </table>
</dl>

<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>(char) the received byte. </dd></dl>

<p>
Definition at line <a class="el" href="a00112.html#l00100">100</a> of file <a class="el" href="a00112.html">spi_lib.c</a>.
<p>
References <a class="el" href="a00111.html#l00112">Spi_read_data</a>, and <a class="el" href="a00111.html#l00115">Spi_send_byte</a>.
<p>
Referenced by <a class="el" href="a00098.html#l00227">hal_nrf_lock_unlock()</a>, <a class="el" href="a00098.html#l00211">hal_nrf_write_ack_pload()</a>, <a class="el" href="a00104.html#l00057">NRF_Read()</a>, <a class="el" href="a00104.html#l00133">NRF_read_buf()</a>, <a class="el" href="a00104.html#l00078">NRF_RW_Reg()</a>, and <a class="el" href="a00104.html#l00101">NRF_write_buf()</a>.<div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102    <a class="code" href="a00042.html#e4fd4823c8d5851c5c2d6b9c79313437">Spi_send_byte</a>(tx);
<a name="l00103"></a>00103    <span class="keywordflow">return</span> <a class="code" href="a00042.html#610afced04d118dbedcaf5e1ff0055e1">Spi_read_data</a>();
<a name="l00104"></a>00104 }
</pre></div>
<p>

<p>
Here is the caller graph for this function:<p><center><img src="a00043_48058f0d26bed0107d1f0141b557ad8b_icgraph.png" border="0" usemap="#a00043_48058f0d26bed0107d1f0141b557ad8b_icgraph_map" alt=""></center>
<map name="a00043_48058f0d26bed0107d1f0141b557ad8b_icgraph_map">
<area href="a00030.html#879863f7f7be332410d790b5cbb2c912" shape="rect" coords="129,158,268,184" alt="">
<area href="a00030.html#397a05d55963be6fb74111d9cf9bf1c4" shape="rect" coords="116,259,281,286" alt="">
<area href="a00036.html#ec197f260d62f70285ef5c14a874aca1" shape="rect" coords="155,6,243,32" alt="">
<area href="a00036.html#82238ef5299abf89313c36ac94c7ee89" shape="rect" coords="144,107,253,134" alt="">
<area href="a00036.html#500e0a5e1a6dcabed1eb20f1c51cd6d3" shape="rect" coords="144,56,253,83" alt="">
<area href="a00036.html#9856ea5a03c048d29e4670d94a87f51f" shape="rect" coords="144,208,253,235" alt="">
<area href="a00067.html#g98096286b36e9d7f8df7c9c733b10e5a" shape="rect" coords="561,158,628,184" alt="">
<area href="a00019.html#cca4b6216b3be1e1db321a93436d004d" shape="rect" coords="716,132,807,159" alt="">
<area href="a00019.html#d8b13fae75396c1142b12e8400bf8282" shape="rect" coords="704,208,819,235" alt="">
<area href="a00067.html#g48fb01570bc2097b9edfa3a8812fa94d" shape="rect" coords="336,259,480,286" alt="">
<area href="a00030.html#299546e4031cda42178a2f41c49bbb00" shape="rect" coords="331,6,485,32" alt="">
<area href="a00067.html#ga01c21a346962faaf73e29722f8dd8bf" shape="rect" coords="535,6,655,32" alt="">
<area href="a00030.html#16eb6527705c9e8c6d9144f0bcf4bcd4" shape="rect" coords="336,107,480,134" alt="">
<area href="a00067.html#gb108b5cbcc502e40c0dc587014ac3086" shape="rect" coords="533,56,656,83" alt="">
<area href="a00067.html#ge6147d552537f3b74c7251af34041a35" shape="rect" coords="548,107,641,134" alt="">
<area href="a00030.html#4529776acbd4170ce057e4fa678a1889" shape="rect" coords="337,208,479,235" alt="">
<area href="a00067.html#gec543eeacba621d36cc71eb399a084aa" shape="rect" coords="548,208,641,235" alt="">
<area href="a00067.html#gaed36c5567ef853d863244f3c8ef85ad" shape="rect" coords="533,259,656,286" alt="">
</map>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jul 7 16:30:14 2008 for ATMEL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
