<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ATMEL: USB device task</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1>USB device task</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00081.html#g7c2af30a7a3db221358b9f016ceb1375">usb_device_task_init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function initializes the USB device controller.  <a href="#g7c2af30a7a3db221358b9f016ceb1375"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00081.html#g3384a2b4d7c3cf2702b11ec8aaa39223">usb_start_device</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function initializes the USB device controller.  <a href="#g3384a2b4d7c3cf2702b11ec8aaa39223"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00081.html#gf07e4fe32a964ffd5b36724976e7c7bd">usb_device_task</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Entry point of the USB device mamagement.  <a href="#gf07e4fe32a964ffd5b36724976e7c7bd"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00081.html#ge7bfe601542c5385c982e6db306b16d3">usb_autobaud</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">USB based autobaud function.  <a href="#ge7bfe601542c5385c982e6db306b16d3"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bit&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00081.html#gd820994baf10758d3b1ec11454ad7fcf">usb_suspended</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Public : (bit) usb_suspended usb_suspended is set to TRUE when USB is in suspend mode usb_suspended is set to FALSE otherwise /.  <a href="#gd820994baf10758d3b1ec11454ad7fcf"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g7c2af30a7a3db221358b9f016ceb1375"></a><!-- doxytag: member="usb_device_task.h::usb_device_task_init" ref="g7c2af30a7a3db221358b9f016ceb1375" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_device_task_init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function initializes the USB device controller. 
<p>
This function enables the USB controller and init the USB interrupts. The aim is to allow the USB connection detection in order to send the appropriate USB event to the operating mode manager.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>none</dd></dl>
/ 
<p>
Definition at line <a class="el" href="a00118.html#l00103">103</a> of file <a class="el" href="a00118.html">usb_device_task.c</a>.
<p>
References <a class="el" href="a00121.html#l00191">Usb_disable</a>, <a class="el" href="a00121.html#l00189">Usb_enable</a>, and <a class="el" href="a00121.html#l00201">Usb_vbus_sense_init</a>.
<p>
Referenced by <a class="el" href="a00126.html#l00159">usb_task_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00104"></a>00104 {
<a name="l00105"></a>00105    <a class="code" href="a00077.html#gb1c7cd82bc66fb726c9ebc86b96db2d2">Usb_disable</a>();
<a name="l00106"></a>00106    <a class="code" href="a00077.html#g002d3da52f4cf2f8f736b9dd1804cdd2">Usb_enable</a>();
<a name="l00107"></a>00107 <span class="preprocessor">#if (VBUS_SENSING_IO == ENABLED)</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>   <a class="code" href="a00077.html#gf288c989e1b6de379dd51d68e3e5e97f">Usb_vbus_sense_init</a>();   <span class="comment">// init. the I/O used for Vbus sensing</span>
<a name="l00109"></a>00109 <span class="preprocessor">#endif</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span>}
</pre></div>
<p>

<p>
Here is the caller graph for this function:<p><center><img src="a00081_g7c2af30a7a3db221358b9f016ceb1375_icgraph.png" border="0" usemap="#a00081_g7c2af30a7a3db221358b9f016ceb1375_icgraph_map" alt=""></center>
<map name="a00081_g7c2af30a7a3db221358b9f016ceb1375_icgraph_map">
<area href="a00083.html#g3f12a1a1edad96df977ce6cf9cc2e334" shape="rect" coords="202,5,300,32" alt="">
</map>

</div>
</div><p>
<a class="anchor" name="g3384a2b4d7c3cf2702b11ec8aaa39223"></a><!-- doxytag: member="usb_device_task.h::usb_start_device" ref="g3384a2b4d7c3cf2702b11ec8aaa39223" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_start_device           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function initializes the USB device controller. 
<p>
This function enables the USB controller and init the USB interrupts. The aim is to allow the USB connection detection in order to send the appropriate USB event to the operating mode manager. Start device function is executed once VBUS connection has been detected either by the VBUS change interrupt either by the VBUS high level<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>none </dd></dl>

<p>
Definition at line <a class="el" href="a00118.html#l00125">125</a> of file <a class="el" href="a00118.html">usb_device_task.c</a>.
<p>
References <a class="el" href="a00121.html#l00250">Usb_attach</a>, <a class="el" href="a00118.html#l00216">usb_autobaud()</a>, <a class="el" href="a00121.html#l00292">Usb_enable_reset_interrupt</a>, <a class="el" href="a00121.html#l00312">Usb_enable_suspend_interrupt</a>, <a class="el" href="a00121.html#l00210">Usb_freeze_clock</a>, <a class="el" href="a00120.html#l00205">usb_init_device()</a>, <a class="el" href="a00121.html#l00197">Usb_reset_all_system</a>, <a class="el" href="a00121.html#l00196">Usb_reset_macro_only</a>, <a class="el" href="a00121.html#l00211">Usb_unfreeze_clock</a>, and <a class="el" href="a00106.html#l00070">Wait_pll_ready</a>.
<p>
Referenced by <a class="el" href="a00118.html#l00157">usb_device_task()</a>.<div class="fragment"><pre class="fragment"><a name="l00126"></a>00126 {
<a name="l00127"></a>00127    <a class="code" href="a00077.html#g84bc0b49ddb8e6cb499d6f4c9bb3eef3">Usb_freeze_clock</a>();
<a name="l00128"></a>00128 <span class="preprocessor">#ifdef BYPASS_USB_AUTOBAUD</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>   Pll_start_auto();
<a name="l00130"></a>00130 <span class="preprocessor">#else</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>   <a class="code" href="a00081.html#ge7bfe601542c5385c982e6db306b16d3">usb_autobaud</a>();
<a name="l00132"></a>00132 <span class="preprocessor">#endif</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>   <a class="code" href="a00071.html#gf8afae5562a37053c7a62ddda9fbf8b1">Wait_pll_ready</a>();
<a name="l00134"></a>00134    <a class="code" href="a00077.html#g8bf7d660725edf11bc4c59baae4b2090">Usb_unfreeze_clock</a>();
<a name="l00135"></a>00135    <a class="code" href="a00078.html#g8b4883ed7eb31838167ff67c74a20647">Usb_attach</a>();
<a name="l00136"></a>00136 <span class="preprocessor">#if (USB_RESET_CPU == ENABLED)</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>   <a class="code" href="a00077.html#g1650347525bab5669c0c7c939f891c56">Usb_reset_all_system</a>();
<a name="l00138"></a>00138 <span class="preprocessor">#else</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>   <a class="code" href="a00077.html#gc609768caa361712186d025418132fbd">Usb_reset_macro_only</a>();
<a name="l00140"></a>00140 <span class="preprocessor">#endif</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span>   <a class="code" href="a00078.html#g51bab31f4a3455524d85528166c4d43e">Usb_enable_suspend_interrupt</a>();
<a name="l00142"></a>00142    <a class="code" href="a00078.html#gb1785329acf114fd5f1e2c88d7d0f1c2">Usb_enable_reset_interrupt</a>();
<a name="l00143"></a>00143    Enable_interrupt();
<a name="l00144"></a>00144    <a class="code" href="a00051.html#f03d76cb0a6201b1c1de6bc25bf6657e">usb_init_device</a>();         <span class="comment">// configure the USB controller EP0</span>
<a name="l00145"></a>00145 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="a00081_g3384a2b4d7c3cf2702b11ec8aaa39223_cgraph.png" border="0" usemap="#a00081_g3384a2b4d7c3cf2702b11ec8aaa39223_cgraph_map" alt=""></center>
<map name="a00081_g3384a2b4d7c3cf2702b11ec8aaa39223_cgraph_map">
<area href="a00081.html#ge7bfe601542c5385c982e6db306b16d3" shape="rect" coords="180,5,287,32" alt="">
<area href="a00051.html#f03d76cb0a6201b1c1de6bc25bf6657e" shape="rect" coords="177,56,289,83" alt="">
</map>

<p>
Here is the caller graph for this function:<p><center><img src="a00081_g3384a2b4d7c3cf2702b11ec8aaa39223_icgraph.png" border="0" usemap="#a00081_g3384a2b4d7c3cf2702b11ec8aaa39223_icgraph_map" alt=""></center>
<map name="a00081_g3384a2b4d7c3cf2702b11ec8aaa39223_icgraph_map">
<area href="a00081.html#gf07e4fe32a964ffd5b36724976e7c7bd" shape="rect" coords="177,5,297,32" alt="">
<area href="a00083.html#gcfc13a32887382f69c46749dad1afa45" shape="rect" coords="348,5,423,32" alt="">
</map>

</div>
</div><p>
<a class="anchor" name="gf07e4fe32a964ffd5b36724976e7c7bd"></a><!-- doxytag: member="usb_device_task.h::usb_device_task" ref="gf07e4fe32a964ffd5b36724976e7c7bd" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_device_task           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Entry point of the USB device mamagement. 
<p>
This function is the entry point of the USB management. Each USB event is checked here in order to launch the appropriate action. If a Setup request occurs on the Default Control Endpoint, the <a class="el" href="a00082.html#g3a56939c3d898bcbbc8208297dccfe93">usb_process_request()</a> function is call in the <a class="el" href="a00055.html">usb_standard_request.c</a> file<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>none </dd></dl>

<p>
Definition at line <a class="el" href="a00118.html#l00157">157</a> of file <a class="el" href="a00118.html">usb_device_task.c</a>.
<p>
References <a class="el" href="a00121.html#l00058">EP_CONTROL</a>, <a class="el" href="a00127.html#l00071">EVT_USB_RESET</a>, <a class="el" href="a00090.html#l00251">FALSE</a>, <a class="el" href="a00127.html#l00058">Is_usb_event</a>, <a class="el" href="a00121.html#l00434">Is_usb_receive_setup</a>, <a class="el" href="a00121.html#l00206">Is_usb_vbus_off</a>, <a class="el" href="a00121.html#l00204">Is_usb_vbus_on</a>, <a class="el" href="a00106.html#l00073">Stop_pll</a>, <a class="el" href="a00090.html#l00252">TRUE</a>, <a class="el" href="a00127.html#l00056">Usb_ack_event</a>, <a class="el" href="a00124.html#l00112">usb_configuration_nb</a>, <a class="el" href="a00118.html#l00069">usb_connected</a>, <a class="el" href="a00121.html#l00248">Usb_detach</a>, <a class="el" href="a00121.html#l00191">Usb_disable</a>, <a class="el" href="a00121.html#l00189">Usb_enable</a>, <a class="el" href="a00124.html#l00138">usb_process_request()</a>, <a class="el" href="a00121.html#l00350">Usb_reset_endpoint</a>, <a class="el" href="a00121.html#l00344">Usb_select_endpoint</a>, <a class="el" href="a00118.html#l00125">usb_start_device()</a>, and <a class="el" href="a00092.html#l00120">Usb_vbus_on_action</a>.
<p>
Referenced by <a class="el" href="a00126.html#l00179">usb_task()</a>.<div class="fragment"><pre class="fragment"><a name="l00158"></a>00158 {
<a name="l00159"></a>00159    <span class="keywordflow">if</span> (<a class="code" href="a00049.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a> == <a class="code" href="a00021.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00160"></a>00160    {
<a name="l00161"></a>00161 <span class="preprocessor">     #if (VBUS_SENSING_IO == ENABLED)</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span>     <span class="keywordflow">if</span> (<a class="code" href="a00077.html#gb67956a4481221d9f4d0090ca518c277">Is_usb_vbus_on</a>())    <span class="comment">// check if Vbus ON to attach</span>
<a name="l00163"></a>00163      {
<a name="l00164"></a>00164        <a class="code" href="a00077.html#g002d3da52f4cf2f8f736b9dd1804cdd2">Usb_enable</a>();
<a name="l00165"></a>00165        <a class="code" href="a00049.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a> = <a class="code" href="a00021.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00166"></a>00166        <a class="code" href="a00081.html#g3384a2b4d7c3cf2702b11ec8aaa39223">usb_start_device</a>();
<a name="l00167"></a>00167        <a class="code" href="a00065.html#g14458cb2f309214b7263228a2a3dea9d">Usb_vbus_on_action</a>();
<a name="l00168"></a>00168      }
<a name="l00169"></a>00169 <span class="preprocessor">     #else</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>     <a class="code" href="a00049.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a> = <a class="code" href="a00021.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;    <span class="comment">// attach if application is not self-powered</span>
<a name="l00171"></a>00171      <a class="code" href="a00081.html#g3384a2b4d7c3cf2702b11ec8aaa39223">usb_start_device</a>();
<a name="l00172"></a>00172      <a class="code" href="a00065.html#g14458cb2f309214b7263228a2a3dea9d">Usb_vbus_on_action</a>();
<a name="l00173"></a>00173 <span class="preprocessor">     #endif</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>   }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="preprocessor">   #if (VBUS_SENSING_IO == ENABLED)</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((<a class="code" href="a00049.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a> == <a class="code" href="a00021.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) &amp;&amp; <a class="code" href="a00077.html#ga982b94e9beb2dc9ef31199bcc0e30c4">Is_usb_vbus_off</a>())  <span class="comment">// check if Vbus OFF to detach</span>
<a name="l00178"></a>00178    {
<a name="l00179"></a>00179      <a class="code" href="a00078.html#g577f33996ee2c40ce8a5e4c700352e72">Usb_detach</a>();
<a name="l00180"></a>00180      <a class="code" href="a00077.html#gb1c7cd82bc66fb726c9ebc86b96db2d2">Usb_disable</a>();
<a name="l00181"></a>00181      <a class="code" href="a00071.html#g022c4595bb52964de09cbdfe47573c80">Stop_pll</a>();
<a name="l00182"></a>00182      <a class="code" href="a00049.html#23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a> = <a class="code" href="a00021.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00183"></a>00183      <a class="code" href="a00049.html#17e7aa663c771d6bddfea612365b55ee">usb_configuration_nb</a>=0;
<a name="l00184"></a>00184    }
<a name="l00185"></a>00185 <span class="preprocessor">   #endif</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span>
<a name="l00187"></a>00187    <span class="keywordflow">if</span>(<a class="code" href="a00084.html#g7c9320480ef6ad04fa7ecc5fbe46794d">Is_usb_event</a>(<a class="code" href="a00084.html#gc28579335a8f21ae1dcef6d69fbb1359">EVT_USB_RESET</a>))
<a name="l00188"></a>00188    {
<a name="l00189"></a>00189       <a class="code" href="a00084.html#g41da8b1e05449acf720091b1cab8cb3f">Usb_ack_event</a>(<a class="code" href="a00084.html#gc28579335a8f21ae1dcef6d69fbb1359">EVT_USB_RESET</a>);
<a name="l00190"></a>00190       <a class="code" href="a00079.html#ga2bbb2260917e717429cc68d0836a5d7">Usb_reset_endpoint</a>(0);
<a name="l00191"></a>00191       <a class="code" href="a00049.html#17e7aa663c771d6bddfea612365b55ee">usb_configuration_nb</a>=0;
<a name="l00192"></a>00192    }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194    <span class="comment">// Here connection to the device enumeration process</span>
<a name="l00195"></a>00195    <a class="code" href="a00079.html#gaeb7643aee75a875fb6c51f81afbaf53">Usb_select_endpoint</a>(<a class="code" href="a00074.html#g60c0c84fbef56ee0649395ebb54ada9c">EP_CONTROL</a>);
<a name="l00196"></a>00196    <span class="keywordflow">if</span> (<a class="code" href="a00079.html#g2ac1b36595ca868b2254c070b41f52bc">Is_usb_receive_setup</a>())
<a name="l00197"></a>00197    {
<a name="l00198"></a>00198       <a class="code" href="a00082.html#g3a56939c3d898bcbbc8208297dccfe93">usb_process_request</a>();
<a name="l00199"></a>00199    }
<a name="l00200"></a>00200 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="a00081_gf07e4fe32a964ffd5b36724976e7c7bd_cgraph.png" border="0" usemap="#a00081_gf07e4fe32a964ffd5b36724976e7c7bd_cgraph_map" alt=""></center>
<map name="a00081_gf07e4fe32a964ffd5b36724976e7c7bd_cgraph_map">
<area href="a00082.html#g3a56939c3d898bcbbc8208297dccfe93" shape="rect" coords="176,259,326,286" alt="">
<area href="a00081.html#g3384a2b4d7c3cf2702b11ec8aaa39223" shape="rect" coords="190,512,312,539" alt="">
<area href="a00055.html#67506404dfea6b29e80cf82bdaea6f22" shape="rect" coords="391,6,519,32" alt="">
<area href="a00055.html#e92ef962c797a8ef223beaa22f3f020a" shape="rect" coords="379,56,531,83" alt="">
<area href="a00055.html#7e07097353481f6d588e8a94f2a2801a" shape="rect" coords="387,107,523,134" alt="">
<area href="a00055.html#42fe778205062c934e4f66abdf63d0ad" shape="rect" coords="391,158,519,184" alt="">
<area href="a00055.html#774479a31f2ffee5cea7968a26ae6064" shape="rect" coords="399,208,511,235" alt="">
<area href="a00055.html#679a1cae6c591cd1083ca444b0c0bd4f" shape="rect" coords="394,259,516,286" alt="">
<area href="a00055.html#f773b5ab99ae3cf3c22b046a49433193" shape="rect" coords="379,310,531,336" alt="">
<area href="a00055.html#9dc9b1584d7841fda822aa46298186f6" shape="rect" coords="396,360,514,387" alt="">
<area href="a00055.html#d924ab761ffddfe9c57f4708af825882" shape="rect" coords="391,411,519,438" alt="">
<area href="a00053.html#d561daf187c11aa8679aa559ac13e322" shape="rect" coords="374,462,536,488" alt="">
<area href="a00055.html#f8f098ba46fe43ac9b2e5ff35799ed9e" shape="rect" coords="630,56,720,83" alt="">
<area href="a00031.html#c0ea9526f3d413fe250b958f8701648f" shape="rect" coords="620,107,730,134" alt="">
<area href="a00053.html#4c69acf3759419bc80ee97e520bc2a1e" shape="rect" coords="591,158,759,184" alt="">
<area href="a00053.html#b5961b9c9678ef0040178b3ae648868b" shape="rect" coords="595,310,755,336" alt="">
<area href="a00053.html#3c9ce9f7e3557533d433271faa51d801" shape="rect" coords="604,386,746,412" alt="">
<area href="a00053.html#77d27d29d89d082e729d593178156e53" shape="rect" coords="615,436,735,463" alt="">
<area href="a00053.html#76d48e14fef77a55e8a4b9bbd954ba1f" shape="rect" coords="586,487,764,514" alt="">
<area href="a00053.html#307c50826a5545b1b887616f8336d33f" shape="rect" coords="604,538,746,564" alt="">
<area href="a00081.html#ge7bfe601542c5385c982e6db306b16d3" shape="rect" coords="402,512,508,539" alt="">
<area href="a00051.html#f03d76cb0a6201b1c1de6bc25bf6657e" shape="rect" coords="399,563,511,590" alt="">
</map>

<p>
Here is the caller graph for this function:<p><center><img src="a00081_gf07e4fe32a964ffd5b36724976e7c7bd_icgraph.png" border="0" usemap="#a00081_gf07e4fe32a964ffd5b36724976e7c7bd_icgraph_map" alt=""></center>
<map name="a00081_gf07e4fe32a964ffd5b36724976e7c7bd_icgraph_map">
<area href="a00083.html#gcfc13a32887382f69c46749dad1afa45" shape="rect" coords="178,5,252,32" alt="">
</map>

</div>
</div><p>
<a class="anchor" name="ge7bfe601542c5385c982e6db306b16d3"></a><!-- doxytag: member="usb_device_task.h::usb_autobaud" ref="ge7bfe601542c5385c982e6db306b16d3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_autobaud           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
USB based autobaud function. 
<p>
This function performs an autobaud configuration for the USB interface. the autobaud function performs the configuration of the PLL dedicated to the USB interface. The autobaud algorithm consists in trying each USB PLL until the correct detection of Start of Frame (USB SOF).<p>
<dl class="warning" compact><dt><b>Warning:</b></dt><dd>Code:?? bytes (function code length)</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>none</em>&nbsp;</td><td></td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>none </dd></dl>

<p>
Clear TOV2 flag and counter value<p>
Clear TOV2 flag and counter value<p>
FOSC 16MHz<p>
FOSC 8MHz 
<p>
Definition at line <a class="el" href="a00118.html#l00216">216</a> of file <a class="el" href="a00118.html">usb_device_task.c</a>.
<p>
References <a class="el" href="a00129.html#l00104">Is_not_wdt_early_warning</a>, <a class="el" href="a00106.html#l00056">PLLx03</a>, <a class="el" href="a00106.html#l00055">PLLx06</a>, <a class="el" href="a00106.html#l00063">Start_pll</a>, <a class="el" href="a00129.html#l00294">Wdt_change_interrupt_16ms</a>, and <a class="el" href="a00129.html#l00119">Wdt_off</a>.
<p>
Referenced by <a class="el" href="a00118.html#l00125">usb_start_device()</a>.<div class="fragment"><pre class="fragment"><a name="l00217"></a>00217 {
<a name="l00218"></a>00218 
<a name="l00219"></a>00219    <a class="code" href="a00021.html#df928e51a60dba0df29d615401cc55a8">U16</a> count_rc=0;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221    <span class="keyword">volatile</span> <a class="code" href="a00021.html#df928e51a60dba0df29d615401cc55a8">U16</a> tempo;
<a name="l00222"></a>00222    
<a name="l00223"></a>00223    <a class="code" href="a00080.html#g9b571d304a85a0a137d7492e24892865">Wdt_change_interrupt_16ms</a>();
<a name="l00224"></a>00224    TCCR1B=0x00; TCCR1A=0x00;
<a name="l00225"></a>00225    TCNT1=0x00;  TIFR1=0x01;            
<a name="l00226"></a>00226    
<a name="l00227"></a>00227    TCCR1B|=(1&lt;&lt;CS01) |(1&lt;&lt;CS00);       <span class="comment">// ClkIO/64, with prescaler /2 -&gt; XTAL/128</span>
<a name="l00228"></a>00228    WDTCKD|=(1&lt;&lt;WDEWIE);
<a name="l00229"></a>00229    <span class="keywordflow">while</span>(<a class="code" href="a00080.html#g3ade94da450d945f18054c966cf29cf0">Is_not_wdt_early_warning</a>());
<a name="l00230"></a>00230    TCCR1B=0;
<a name="l00231"></a>00231    <a class="code" href="a00080.html#g685a43b6ab7a0acf3111a2228e094377">Wdt_off</a>();
<a name="l00232"></a>00232    WDTCKD|=(1&lt;&lt;WDEWIF);                <span class="comment">// Clear early warning flag</span>
<a name="l00233"></a>00233    WDTCKD=0;                           <span class="comment">// Clear early warning flag</span>
<a name="l00234"></a>00234    
<a name="l00235"></a>00235    count_rc=TCNT1;
<a name="l00236"></a>00236    TCCR1B=0x00; TCCR1A=0x00;
<a name="l00237"></a>00237    TCNT1=0x00;  TIFR1=0x01;            
<a name="l00238"></a>00238    <span class="keywordflow">if</span>(count_rc&gt;1500)                   <span class="comment">// 16MHz/128 with 16ms watchdog gives 2000 ticks</span>
<a name="l00239"></a>00239    {
<a name="l00240"></a>00240       <a class="code" href="a00071.html#g8d6aa5ff80fec560257e20e1a35b44e1">Start_pll</a>(<a class="code" href="a00071.html#gb045be45b314fb1b731783a1243bdcb1">PLLx03</a>);               
<a name="l00241"></a>00241    }
<a name="l00242"></a>00242    <span class="keywordflow">else</span>
<a name="l00243"></a>00243    {
<a name="l00244"></a>00244       <a class="code" href="a00071.html#g8d6aa5ff80fec560257e20e1a35b44e1">Start_pll</a>(<a class="code" href="a00071.html#g56fec05c7a163201ec3cd0d7aa21cce5">PLLx06</a>);                
<a name="l00245"></a>00245    }
<a name="l00246"></a>00246    
<a name="l00247"></a>00247 }
</pre></div>
<p>

<p>
Here is the caller graph for this function:<p><center><img src="a00081_ge7bfe601542c5385c982e6db306b16d3_icgraph.png" border="0" usemap="#a00081_ge7bfe601542c5385c982e6db306b16d3_icgraph_map" alt=""></center>
<map name="a00081_ge7bfe601542c5385c982e6db306b16d3_icgraph_map">
<area href="a00081.html#g3384a2b4d7c3cf2702b11ec8aaa39223" shape="rect" coords="160,5,283,32" alt="">
<area href="a00081.html#gf07e4fe32a964ffd5b36724976e7c7bd" shape="rect" coords="332,5,452,32" alt="">
<area href="a00083.html#gcfc13a32887382f69c46749dad1afa45" shape="rect" coords="503,5,577,32" alt="">
</map>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="gd820994baf10758d3b1ec11454ad7fcf"></a><!-- doxytag: member="usb_device_task.h::usb_suspended" ref="gd820994baf10758d3b1ec11454ad7fcf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bit <a class="el" href="a00081.html#gd820994baf10758d3b1ec11454ad7fcf">usb_suspended</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Public : (bit) usb_suspended usb_suspended is set to TRUE when USB is in suspend mode usb_suspended is set to FALSE otherwise /. 
<p>

<p>
Definition at line <a class="el" href="a00118.html#l00076">76</a> of file <a class="el" href="a00118.html">usb_device_task.c</a>.
<p>
Referenced by <a class="el" href="a00126.html#l00206">usb_general_interrupt()</a>.
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jul 7 16:30:37 2008 for ATMEL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
