<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ATMEL: cdc_rf_task.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>cdc_rf_task.h File Reference</h1>This file contains the function declarations for the cdc_rf task. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="a00093.html">config.h</a>&quot;</code><br>

<p>
Include dependency graph for cdc_rf_task.h:<p><center><img src="a00133.png" border="0" usemap="#cdc_rf_task.h_map" alt=""></center>
<map name="cdc_rf_task.h_map">
<area href="a00024.html" shape="rect" coords="155,56,224,83" alt="">
<area href="a00021.html" shape="rect" coords="355,6,488,32" alt="">
<area href="a00022.html" shape="rect" coords="345,56,497,83" alt="">
<area href="a00016.html" shape="rect" coords="273,107,569,134" alt="">
</map>

<p>
This graph shows which files directly or indirectly include this file:<p><center><img src="a00134.png" border="0" usemap="#cdc_rf_task.hdep_map" alt=""></center>
<map name="cdc_rf_task.hdep_map">
<area href="a00019.html" shape="rect" coords="155,5,256,32" alt="">
</map>

<p>
<a href="a00089.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#d9a4638e0b0bfbcfe0bfe7c211dcfd42">sof_action</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">sof_action  <a href="#d9a4638e0b0bfbcfe0bfe7c211dcfd42"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bit&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#0e9d610ff7be1e36af2fde1a837c90bf">usb_test_hit</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if a character has been received on the USB bus.  <a href="#0e9d610ff7be1e36af2fde1a837c90bf"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#d4fb7e742445932a659c1bc3dc12ea66">usb_getchar</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function reads one byte from the USB bus.  <a href="#d4fb7e742445932a659c1bc3dc12ea66"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bit&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#db560ecdac14b36f7b1ce92a434c05d6">usb_tx_ready</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the USB emission buffer is ready to accept at at least 1 byte.  <a href="#db560ecdac14b36f7b1ce92a434c05d6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#e5062c54fdd86ddd65fd9e4ba6865178">usb_putchar</a> (int)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b202aac13d24d19918c481d263b7ebc9">usb_send_buffer</a> (<a class="el" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> *<a class="el" href="a00019.html#86df9ca0c324fea9ddc4a0e8d286963d">buffer</a>, <a class="el" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> nb_data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function transmits a ram buffer content to the USB.  <a href="#b202aac13d24d19918c481d263b7ebc9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#82620624247c888a70f869c0b0bf70cf">usb_read_buffer</a> (<a class="el" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> *<a class="el" href="a00019.html#86df9ca0c324fea9ddc4a0e8d286963d">buffer</a>, <a class="el" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> *nb_data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function receives data from the USB and fills a ram buffer.  <a href="#82620624247c888a70f869c0b0bf70cf"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This file contains the function declarations for the cdc_rf task. 
<p>
<ul>
<li>Compiler: IAR EWAVR and GNU GCC for AVR</li><li>Supported devices: AT90USB162, AT90USB82</li></ul>
<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support and FAQ: <a href="http://support.atmel.no/">http://support.atmel.no/</a> </dd></dl>

<p>
Definition in file <a class="el" href="a00089.html">cdc_rf_task.h</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="d9a4638e0b0bfbcfe0bfe7c211dcfd42"></a><!-- doxytag: member="cdc_rf_task.h::sof_action" ref="d9a4638e0b0bfbcfe0bfe7c211dcfd42" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sof_action           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
sof_action 
<p>
USB Start Of Frame Interrupt user subroutine, executed each 1ms 
<p>
Definition at line <a class="el" href="a00088.html#l00236">236</a> of file <a class="el" href="a00088.html">cdc_rf_task.c</a>.<div class="fragment"><pre class="fragment"><a name="l00237"></a>00237 {
<a name="l00238"></a>00238 
<a name="l00239"></a>00239    <a class="code" href="a00019.html#438a6c4031a832b636f31d97f5effb0a">cpt_sof</a>++;
<a name="l00240"></a>00240    <span class="keywordflow">if</span>(<a class="code" href="a00019.html#8fab9a1eb84704d9d1e7a8db47396245">led_tx_flash</a>&lt;=<a class="code" href="a00066.html#g73b40dba309b827de86d9cb20fab1414">LED_FLASH_DELAY</a>)
<a name="l00241"></a>00241    {
<a name="l00242"></a>00242      <a class="code" href="a00019.html#8fab9a1eb84704d9d1e7a8db47396245">led_tx_flash</a>++;
<a name="l00243"></a>00243    }
<a name="l00244"></a>00244    <span class="keywordflow">if</span>(<a class="code" href="a00019.html#8fab9a1eb84704d9d1e7a8db47396245">led_tx_flash</a>==<a class="code" href="a00066.html#g73b40dba309b827de86d9cb20fab1414">LED_FLASH_DELAY</a>)
<a name="l00245"></a>00245    {
<a name="l00246"></a>00246       <a class="code" href="a00016.html#dfbab5c3a570701230b6e5c871434968">Led1_off</a>();     
<a name="l00247"></a>00247    }
<a name="l00248"></a>00248    
<a name="l00249"></a>00249    <span class="keywordflow">if</span>(<a class="code" href="a00019.html#005c90c68b04f6bc2cb85a5faeb26461">led_rx_flash</a>&lt;=<a class="code" href="a00066.html#g73b40dba309b827de86d9cb20fab1414">LED_FLASH_DELAY</a>)
<a name="l00250"></a>00250    {
<a name="l00251"></a>00251      <a class="code" href="a00019.html#005c90c68b04f6bc2cb85a5faeb26461">led_rx_flash</a>++;
<a name="l00252"></a>00252    }
<a name="l00253"></a>00253    <span class="keywordflow">if</span>(<a class="code" href="a00019.html#005c90c68b04f6bc2cb85a5faeb26461">led_rx_flash</a>==<a class="code" href="a00066.html#g73b40dba309b827de86d9cb20fab1414">LED_FLASH_DELAY</a>)
<a name="l00254"></a>00254    {
<a name="l00255"></a>00255       <a class="code" href="a00016.html#f8975e745aed0bacef7ba7fd310caee2">Led0_off</a>();     
<a name="l00256"></a>00256    }
<a name="l00257"></a>00257    
<a name="l00258"></a>00258 
<a name="l00259"></a>00259    <span class="keywordflow">if</span>(<a class="code" href="a00019.html#141d6ea040ac3fbf81c14c781297b2d3">cpt_sof_led</a>++&gt;=<a class="code" href="a00066.html#g911b1ff9f0fab14694c350ef20c93552">RF_LEDS_OFF_DELAY</a>+<a class="code" href="a00066.html#g16a8c367845b5730153bcc1d82fb1af1">RF_LEDS_FLASH_DELAY</a>+1) <a class="code" href="a00019.html#141d6ea040ac3fbf81c14c781297b2d3">cpt_sof_led</a>=0;
<a name="l00260"></a>00260    <span class="keywordflow">if</span>(<a class="code" href="a00019.html#141d6ea040ac3fbf81c14c781297b2d3">cpt_sof_led</a>==<a class="code" href="a00066.html#g911b1ff9f0fab14694c350ef20c93552">RF_LEDS_OFF_DELAY</a>)
<a name="l00261"></a>00261    {
<a name="l00262"></a>00262        <a class="code" href="a00016.html#e3686baa5778f89302a7b9989cc49bc9">Led0_on</a>();
<a name="l00263"></a>00263        <a class="code" href="a00016.html#8ab986ba8e40a24d48c5fde183bacf0c">Led1_on</a>();
<a name="l00264"></a>00264    }
<a name="l00265"></a>00265    <span class="keywordflow">if</span>(<a class="code" href="a00019.html#141d6ea040ac3fbf81c14c781297b2d3">cpt_sof_led</a>==<a class="code" href="a00066.html#g911b1ff9f0fab14694c350ef20c93552">RF_LEDS_OFF_DELAY</a>+<a class="code" href="a00066.html#g16a8c367845b5730153bcc1d82fb1af1">RF_LEDS_FLASH_DELAY</a>)
<a name="l00266"></a>00266    {
<a name="l00267"></a>00267        <a class="code" href="a00016.html#f8975e745aed0bacef7ba7fd310caee2">Led0_off</a>();
<a name="l00268"></a>00268        <a class="code" href="a00016.html#dfbab5c3a570701230b6e5c871434968">Led1_off</a>();
<a name="l00269"></a>00269    }
<a name="l00270"></a>00270  
<a name="l00271"></a>00271 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0e9d610ff7be1e36af2fde1a837c90bf"></a><!-- doxytag: member="cdc_rf_task.h::usb_test_hit" ref="0e9d610ff7be1e36af2fde1a837c90bf" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bit usb_test_hit           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if a character has been received on the USB bus. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The function returns a TRUE bit if a byte is ready to be read. </dd></dl>

<p>
Definition at line <a class="el" href="a00088.html#l00279">279</a> of file <a class="el" href="a00088.html">cdc_rf_task.c</a>.
<p>
References <a class="el" href="a00121.html#l00436">Is_usb_receive_out</a>, <a class="el" href="a00088.html#l00084">rx_counter</a>, <a class="el" href="a00092.html#l00103">TX_EP</a>, <a class="el" href="a00121.html#l00418">Usb_ack_receive_out</a>, <a class="el" href="a00121.html#l00483">Usb_byte_counter</a>, and <a class="el" href="a00121.html#l00344">Usb_select_endpoint</a>.
<p>
Referenced by <a class="el" href="a00088.html#l00135">cdc_rf_task()</a>, and <a class="el" href="a00088.html#l00303">usb_getchar()</a>.<div class="fragment"><pre class="fragment"><a name="l00280"></a>00280 {
<a name="l00281"></a>00281   <span class="keywordflow">if</span> (!<a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a>)
<a name="l00282"></a>00282   {
<a name="l00283"></a>00283     <a class="code" href="a00079.html#gaeb7643aee75a875fb6c51f81afbaf53">Usb_select_endpoint</a>(<a class="code" href="a00064.html#gc1a5b0c671e1d56e87cd1b0a9f3b5b4a">TX_EP</a>);
<a name="l00284"></a>00284     <span class="keywordflow">if</span> (<a class="code" href="a00079.html#g196963f8f36f0fdf39a4ee1dd2e86463">Is_usb_receive_out</a>())
<a name="l00285"></a>00285     {
<a name="l00286"></a>00286       <a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a> = <a class="code" href="a00079.html#g33548097f2a940d4b11213c19c77098d">Usb_byte_counter</a>();
<a name="l00287"></a>00287       <span class="keywordflow">if</span> (!<a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a>)
<a name="l00288"></a>00288       {
<a name="l00289"></a>00289         <a class="code" href="a00079.html#g2bcdff32843bb358fa2f99d3d98452cd">Usb_ack_receive_out</a>();
<a name="l00290"></a>00290       }
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292   }
<a name="l00293"></a>00293   <span class="keywordflow">return</span> (<a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a>!=0);
<a name="l00294"></a>00294 }
</pre></div>
<p>

<p>
Here is the caller graph for this function:<p><center><img src="a00020_0e9d610ff7be1e36af2fde1a837c90bf_icgraph.png" border="0" usemap="#a00020_0e9d610ff7be1e36af2fde1a837c90bf_icgraph_map" alt=""></center>
<map name="a00020_0e9d610ff7be1e36af2fde1a837c90bf_icgraph_map">
<area href="a00019.html#cca4b6216b3be1e1db321a93436d004d" shape="rect" coords="152,5,243,32" alt="">
<area href="a00020.html#d4fb7e742445932a659c1bc3dc12ea66" shape="rect" coords="150,56,246,83" alt="">
</map>

</div>
</div><p>
<a class="anchor" name="d4fb7e742445932a659c1bc3dc12ea66"></a><!-- doxytag: member="cdc_rf_task.h::usb_getchar" ref="d4fb7e742445932a659c1bc3dc12ea66" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char usb_getchar           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function reads one byte from the USB bus. 
<p>
If one byte is present in the USB fifo, this byte is returned. If no data is present in the USB fifo, this function waits for USB data.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The function returns the received byte. </dd></dl>

<p>
Definition at line <a class="el" href="a00088.html#l00303">303</a> of file <a class="el" href="a00088.html">cdc_rf_task.c</a>.
<p>
References <a class="el" href="a00088.html#l00084">rx_counter</a>, <a class="el" href="a00092.html#l00103">TX_EP</a>, <a class="el" href="a00121.html#l00418">Usb_ack_receive_out</a>, <a class="el" href="a00121.html#l00478">Usb_read_byte</a>, <a class="el" href="a00121.html#l00344">Usb_select_endpoint</a>, and <a class="el" href="a00088.html#l00279">usb_test_hit()</a>.<div class="fragment"><pre class="fragment"><a name="l00304"></a>00304 {
<a name="l00305"></a>00305   <span class="keyword">register</span> <a class="code" href="a00021.html#5c3641e5dfe71f67a3c3a72026a24af2">Uchar</a> data_rx;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <a class="code" href="a00079.html#gaeb7643aee75a875fb6c51f81afbaf53">Usb_select_endpoint</a>(<a class="code" href="a00064.html#gc1a5b0c671e1d56e87cd1b0a9f3b5b4a">TX_EP</a>);
<a name="l00308"></a>00308   <span class="keywordflow">if</span> (!<a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a>) <span class="keywordflow">while</span> (!<a class="code" href="a00019.html#0e9d610ff7be1e36af2fde1a837c90bf">usb_test_hit</a>());
<a name="l00309"></a>00309   data_rx=<a class="code" href="a00079.html#gf3407eef62060301890f9129ab090bbd">Usb_read_byte</a>();
<a name="l00310"></a>00310   <a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a>--;
<a name="l00311"></a>00311   <span class="keywordflow">if</span> (!<a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a>) <a class="code" href="a00079.html#g2bcdff32843bb358fa2f99d3d98452cd">Usb_ack_receive_out</a>();
<a name="l00312"></a>00312   <span class="keywordflow">return</span> data_rx;
<a name="l00313"></a>00313 }
</pre></div>
<p>

<p>
Here is the call graph for this function:<p><center><img src="a00020_d4fb7e742445932a659c1bc3dc12ea66_cgraph.png" border="0" usemap="#a00020_d4fb7e742445932a659c1bc3dc12ea66_cgraph_map" alt=""></center>
<map name="a00020_d4fb7e742445932a659c1bc3dc12ea66_cgraph_map">
<area href="a00019.html#0e9d610ff7be1e36af2fde1a837c90bf" shape="rect" coords="151,5,244,32" alt="">
</map>

</div>
</div><p>
<a class="anchor" name="db560ecdac14b36f7b1ce92a434c05d6"></a><!-- doxytag: member="cdc_rf_task.h::usb_tx_ready" ref="db560ecdac14b36f7b1ce92a434c05d6" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bit usb_tx_ready           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the USB emission buffer is ready to accept at at least 1 byte. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The function returns TRUE if the firmware can write a new byte to transmit. </dd></dl>

<p>
Definition at line <a class="el" href="a00088.html#l00321">321</a> of file <a class="el" href="a00088.html">cdc_rf_task.c</a>.
<p>
References <a class="el" href="a00090.html#l00251">FALSE</a>, <a class="el" href="a00121.html#l00428">Is_usb_write_enabled</a>, and <a class="el" href="a00090.html#l00252">TRUE</a>.<div class="fragment"><pre class="fragment"><a name="l00322"></a>00322 {
<a name="l00323"></a>00323   <span class="keywordflow">if</span> (!<a class="code" href="a00079.html#g1b470916df610d8750a5a5916976e687">Is_usb_write_enabled</a>())
<a name="l00324"></a>00324   {
<a name="l00325"></a>00325     <span class="keywordflow">return</span> <a class="code" href="a00021.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00326"></a>00326   }
<a name="l00327"></a>00327   <span class="keywordflow">return</span> <a class="code" href="a00021.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00328"></a>00328 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e5062c54fdd86ddd65fd9e4ba6865178"></a><!-- doxytag: member="cdc_rf_task.h::usb_putchar" ref="e5062c54fdd86ddd65fd9e4ba6865178" args="(int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int usb_putchar           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="b202aac13d24d19918c481d263b7ebc9"></a><!-- doxytag: member="cdc_rf_task.h::usb_send_buffer" ref="b202aac13d24d19918c481d263b7ebc9" args="(U8 *buffer, U8 nb_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_send_buffer           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a>&nbsp;</td>
          <td class="paramname"> <em>nb_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function transmits a ram buffer content to the USB. 
<p>
This function is mode efficient in term of USB bandwith transfer.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>U8</em>&nbsp;</td><td>*buffer : the pointer to the RAM buffer to be sent </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data_to_send</em>&nbsp;</td><td>: the number of data to be sent </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00088.html#l00339">339</a> of file <a class="el" href="a00088.html">cdc_rf_task.c</a>.
<p>
References <a class="el" href="a00090.html#l00251">FALSE</a>, <a class="el" href="a00121.html#l00428">Is_usb_write_enabled</a>, <a class="el" href="a00092.html#l00104">RX_EP</a>, <a class="el" href="a00117.html#l00111">RX_EP_SIZE</a>, <a class="el" href="a00090.html#l00252">TRUE</a>, <a class="el" href="a00121.html#l00422">Usb_ack_in_ready</a>, <a class="el" href="a00121.html#l00344">Usb_select_endpoint</a>, <a class="el" href="a00121.html#l00480">Usb_write_byte</a>, and <a class="el" href="a00124.html#l00095">zlp</a>.
<p>
Referenced by <a class="el" href="a00088.html#l00135">cdc_rf_task()</a>.<div class="fragment"><pre class="fragment"><a name="l00340"></a>00340 {
<a name="l00341"></a>00341    <a class="code" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> <a class="code" href="a00055.html#59197a52cee065f61c442623fff224a6">zlp</a>;
<a name="l00342"></a>00342    
<a name="l00343"></a>00343    <span class="comment">// Compute if zlp required</span>
<a name="l00344"></a>00344    <span class="keywordflow">if</span>(nb_data%<a class="code" href="a00048.html#35ef88ccbba30d42544464099038184a">RX_EP_SIZE</a>) 
<a name="l00345"></a>00345    { zlp=<a class="code" href="a00021.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;} 
<a name="l00346"></a>00346    <span class="keywordflow">else</span> { zlp=<a class="code" href="a00021.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; }
<a name="l00347"></a>00347    
<a name="l00348"></a>00348    <a class="code" href="a00079.html#gaeb7643aee75a875fb6c51f81afbaf53">Usb_select_endpoint</a>(<a class="code" href="a00064.html#g7a1f97873bf07b1dd6288acbbb854787">RX_EP</a>);
<a name="l00349"></a>00349    <span class="keywordflow">while</span> (nb_data)
<a name="l00350"></a>00350    {
<a name="l00351"></a>00351       <span class="keywordflow">while</span>(<a class="code" href="a00079.html#g1b470916df610d8750a5a5916976e687">Is_usb_write_enabled</a>()==<a class="code" href="a00021.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>); <span class="comment">// Wait Endpoint ready</span>
<a name="l00352"></a>00352       <span class="keywordflow">while</span>(<a class="code" href="a00079.html#g1b470916df610d8750a5a5916976e687">Is_usb_write_enabled</a>() &amp;&amp; nb_data)
<a name="l00353"></a>00353       {
<a name="l00354"></a>00354          <a class="code" href="a00079.html#g922407bbf41e71cb77d2af191c6f58b7">Usb_write_byte</a>(*<a class="code" href="a00019.html#86df9ca0c324fea9ddc4a0e8d286963d">buffer</a>);
<a name="l00355"></a>00355          <a class="code" href="a00019.html#86df9ca0c324fea9ddc4a0e8d286963d">buffer</a>++;
<a name="l00356"></a>00356          nb_data--;
<a name="l00357"></a>00357       }
<a name="l00358"></a>00358       <a class="code" href="a00079.html#g3bbe005bbde0c9a79358aa97782ad66f">Usb_ack_in_ready</a>();
<a name="l00359"></a>00359    }
<a name="l00360"></a>00360    <span class="keywordflow">if</span>(zlp)
<a name="l00361"></a>00361    {
<a name="l00362"></a>00362       <span class="keywordflow">while</span>(<a class="code" href="a00079.html#g1b470916df610d8750a5a5916976e687">Is_usb_write_enabled</a>()==<a class="code" href="a00021.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>); <span class="comment">// Wait Endpoint ready</span>
<a name="l00363"></a>00363       <a class="code" href="a00079.html#g3bbe005bbde0c9a79358aa97782ad66f">Usb_ack_in_ready</a>();
<a name="l00364"></a>00364    }
<a name="l00365"></a>00365 }
</pre></div>
<p>

<p>
Here is the caller graph for this function:<p><center><img src="a00020_b202aac13d24d19918c481d263b7ebc9_icgraph.png" border="0" usemap="#a00020_b202aac13d24d19918c481d263b7ebc9_icgraph_map" alt=""></center>
<map name="a00020_b202aac13d24d19918c481d263b7ebc9_icgraph_map">
<area href="a00019.html#cca4b6216b3be1e1db321a93436d004d" shape="rect" coords="176,5,267,32" alt="">
</map>

</div>
</div><p>
<a class="anchor" name="82620624247c888a70f869c0b0bf70cf"></a><!-- doxytag: member="cdc_rf_task.h::usb_read_buffer" ref="82620624247c888a70f869c0b0bf70cf" args="(U8 *buffer, U8 *nb_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_read_buffer           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00021.html#3cb25ca6f51f003950f9625ff05536fc">U8</a> *&nbsp;</td>
          <td class="paramname"> <em>nb_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function receives data from the USB and fills a ram buffer. 
<p>
This function is more efficient in term of USB bandwith transfer.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>U8</em>&nbsp;</td><td>*buffer : the pointer to the RAM buffer to be filled </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>U8</em>&nbsp;</td><td>nb_data : the number of received data bytes </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="a00088.html#l00376">376</a> of file <a class="el" href="a00088.html">cdc_rf_task.c</a>.
<p>
References <a class="el" href="a00088.html#l00084">rx_counter</a>, <a class="el" href="a00092.html#l00103">TX_EP</a>, <a class="el" href="a00121.html#l00418">Usb_ack_receive_out</a>, <a class="el" href="a00121.html#l00478">Usb_read_byte</a>, and <a class="el" href="a00121.html#l00344">Usb_select_endpoint</a>.
<p>
Referenced by <a class="el" href="a00088.html#l00135">cdc_rf_task()</a>.<div class="fragment"><pre class="fragment"><a name="l00377"></a>00377 {
<a name="l00378"></a>00378    
<a name="l00379"></a>00379    *nb_data = <a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a>;                      <span class="comment">//store the number of received data bytes</span>
<a name="l00380"></a>00380    
<a name="l00381"></a>00381    <a class="code" href="a00079.html#gaeb7643aee75a875fb6c51f81afbaf53">Usb_select_endpoint</a>(<a class="code" href="a00064.html#gc1a5b0c671e1d56e87cd1b0a9f3b5b4a">TX_EP</a>); 
<a name="l00382"></a>00382    
<a name="l00383"></a>00383    <span class="keywordflow">while</span> (<a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a>)
<a name="l00384"></a>00384    {
<a name="l00385"></a>00385     
<a name="l00386"></a>00386     *<a class="code" href="a00019.html#86df9ca0c324fea9ddc4a0e8d286963d">buffer</a>=<a class="code" href="a00079.html#gf3407eef62060301890f9129ab090bbd">Usb_read_byte</a>();
<a name="l00387"></a>00387     <a class="code" href="a00019.html#86df9ca0c324fea9ddc4a0e8d286963d">buffer</a>++;
<a name="l00388"></a>00388     <a class="code" href="a00019.html#0795cfcc2bee153d9baf4f6c82a65cf8">rx_counter</a>--;   
<a name="l00389"></a>00389     
<a name="l00390"></a>00390    } 
<a name="l00391"></a>00391    
<a name="l00392"></a>00392    <a class="code" href="a00079.html#g2bcdff32843bb358fa2f99d3d98452cd">Usb_ack_receive_out</a>(); 
<a name="l00393"></a>00393    
<a name="l00394"></a>00394 }</pre></div>
<p>

<p>
Here is the caller graph for this function:<p><center><img src="a00020_82620624247c888a70f869c0b0bf70cf_icgraph.png" border="0" usemap="#a00020_82620624247c888a70f869c0b0bf70cf_icgraph_map" alt=""></center>
<map name="a00020_82620624247c888a70f869c0b0bf70cf_icgraph_map">
<area href="a00019.html#cca4b6216b3be1e1db321a93436d004d" shape="rect" coords="173,5,264,32" alt="">
</map>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jul 7 16:29:54 2008 for ATMEL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
